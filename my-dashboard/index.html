<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Verification</title>
    <style>
        :root {
            --primary: #2563eb;
            --error: #dc2626;
            --bg: #f8fafc;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background: var(--bg);
        }

        .card {
            background: white;
            padding: 2.5rem;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 420px;
            border: 1px solid #e2e8f0;
        }

        .timer-container {
            background: #e2e8f0;
            height: 6px;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        #timerBar {
            background: var(--primary);
            height: 100%;
            width: 100%;
            transition: width 1s linear;
        }

        .section {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 600;
            color: #1e293b;
            font-size: 0.9rem;
        }

        input,
        select {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
        }

        button {
            width: 100%;
            padding: 14px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 15px;
            font-size: 1rem;
        }

        button:hover {
            background: #1d4ed8;
        }

        #timerText {
            text-align: right;
            font-weight: bold;
            color: var(--error);
            font-variant-numeric: tabular-nums;
            margin-bottom: 5px;
        }

        #msg {
            text-align: center;
            font-size: 0.9rem;
            margin-top: 15px;
            font-weight: 600;
            min-height: 1.2rem;
        }

        h3 {
            margin-top: 0;
            color: #64748b;
            font-size: 1rem;
        }

        h2 {
            margin-top: 5px;
            color: #0f172a;
            border-bottom: 1px solid #f1f5f9;
            padding-bottom: 10px;
            font-size: 1.25rem;
        }
    </style>
</head>

<body>

    <div class="card">
        <h3>เช็คหน่อยว่าเป็น ทีมเดียวกันไหม!! </h3>
        <h2>Security Check "Sp@2l&lt;"</h2>

        <div id="timerText">00:30</div>
        <div class="timer-container">
            <div id="timerBar"></div>
        </div>

        <div class="section">
            <label for="passInput">System Password</label>
            <input type="password" id="passInput" placeholder="Enter security key">
        </div>

        <div class="section">
            <label id="mathLabel">Loading math...</label>
            <input type="number" id="mathInput" placeholder="Result">
        </div>

        <div class="section">
            <label id="qLabel">Loading question...</label>
            <select id="qSelect"></select>
        </div>

        <button onclick="checkAnswers()">Unlock Dashboard</button>
        <div id="msg"></div>
    </div>

    <script>

        const PASS_HASH = "748058728989f6103606f7093259b1a50098df981e19f7274092497645f7f985";

        const questionBank = [
            { q: "Capital of Japan?", a: "Tokyo", opt: ["Seoul", "Tokyo", "Beijing", "Bangkok"] },
            { q: "Largest ocean?", a: "Pacific", opt: ["Atlantic", "Indian", "Arctic", "Pacific"] },
            { q: "Colors in a rainbow?", a: "7", opt: ["5", "6", "7", "8"] },
            { q: "Square root of 64?", a: "8", opt: ["6", "7", "8", "9"] },
            { q: "Closest planet to Sun?", a: "Mercury", opt: ["Venus", "Mars", "Mercury", "Earth"] },
            { q: "Symbol for Gold?", a: "Au", opt: ["Ag", "Au", "Gd", "Fe"] },
            { q: "Number of continents?", a: "7", opt: ["5", "6", "7", "8"] },
            { q: "King of the Jungle?", a: "Lion", opt: ["Tiger", "Elephant", "Lion", "Gorilla"] },
            { q: "Largest human organ?", a: "Skin", opt: ["Heart", "Liver", "Skin", "Lungs"] },
            { q: "Year Titanic sank?", a: "1912", opt: ["1905", "1912", "1920", "1933"] },
            { q: "Painted Mona Lisa?", a: "Da Vinci", opt: ["Picasso", "Van Gogh", "Da Vinci", "Dalí"] },
            { q: "Hardest substance?", a: "Diamond", opt: ["Gold", "Iron", "Diamond", "Quartz"] },
            { q: "Minutes in one hour?", a: "60", opt: ["50", "60", "100", "120"] },
            { q: "Home of the Kangaroo?", a: "Australia", opt: ["India", "Australia", "Brazil", "Egypt"] },
            { q: "Currency of USA?", a: "Dollar", opt: ["Euro", "Yen", "Pound", "Dollar"] },
            { q: "Number of US states?", a: "50", opt: ["48", "49", "50", "51"] },
            { q: "What do bees make?", a: "Honey", opt: ["Milk", "Honey", "Wax", "Silk"] },
            { q: "Tallest mountain?", a: "Everest", opt: ["K2", "Everest", "Fuji", "Lhotse"] },
            { q: "Glass ingredient?", a: "Sand", opt: ["Clay", "Sand", "Salt", "Lime"] },
            { q: "Standard violin strings?", a: "4", opt: ["3", "4", "5", "6"] }
        ];

        let timeLeft = 30;
        let timerId;
        let correctMath, correctQ;

        // ฟังก์ชันคำนวณ Hash (SHA-256)
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            return hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        }

        function startTimer() {
            timeLeft = 30;
            updateTimerUI();
            clearInterval(timerId);
            timerId = setInterval(() => {
                timeLeft--;
                updateTimerUI();
                if (timeLeft <= 0) {
                    clearInterval(timerId);
                    showError("Time expired! Resetting...");
                    setTimeout(setupGame, 1000);
                }
            }, 1000);
        }

        function updateTimerUI() {
            document.getElementById('timerText').innerText = `00:${timeLeft < 10 ? '0' + timeLeft : timeLeft}`;
            document.getElementById('timerBar').style.width = (timeLeft / 30 * 100) + "%";
        }

        function setupGame() {
            document.getElementById('mathInput').value = "";
            document.getElementById('passInput').value = "";

            const n1 = Math.floor(Math.random() * 15) + 2;
            const n2 = Math.floor(Math.random() * 15) + 2;
            correctMath = n1 + n2;
            document.getElementById('mathLabel').innerText = `What is ${n1} + ${n2}?`;

            const rand = questionBank[Math.floor(Math.random() * questionBank.length)];
            correctQ = rand.a;
            document.getElementById('qLabel').innerText = rand.q;

            const select = document.getElementById('qSelect');
            select.innerHTML = '<option value="">-- Select Answer --</option>';
            [...rand.opt].sort(() => Math.random() - 0.5).forEach(o => {
                let el = document.createElement("option");
                el.value = el.textContent = o;
                select.appendChild(el);
            });

            document.getElementById('msg').innerText = "";
            startTimer();
        }

        function showError(text) {
            const msg = document.getElementById('msg');
            msg.style.color = "var(--error)";
            msg.innerText = text;
        }

        async function checkAnswers() {
            const uPass = document.getElementById('passInput').value;
            const uMath = parseInt(document.getElementById('mathInput').value);
            const uQ = document.getElementById('qSelect').value;

            const uPassHash = await sha256(uPass);

            if (uPassHash === PASS_HASH && uMath === correctMath && uQ === correctQ) {
                clearInterval(timerId);
                const msg = document.getElementById('msg');
                msg.style.color = "#059669";
                msg.innerText = "Access Granted! Redirecting...";
                setTimeout(() => window.location.href = "dashboard.html", 1200);
            } else {
                showError("Verification failed. Try again.");
                setTimeout(setupGame, 1000);
            }
        }

        window.onload = setupGame;
    </script>

</body>

</html>